var aws=require("aws-sdk"),response=require("cfn-response");aws.config.region=process.env.AWS_REGION;var lambda=new aws.Lambda,sagemaker=new aws.SageMaker;exports.handler=function(event,context,callback){console.log(JSON.stringify(event,null,2));event.ResourceProperties;"Delete"===event.RequestType?sagemaker.listEndpointConfigs({NameContains:event.name,NextToken:event.NextToken}).promise().then(result=>{if(result.EndpointConfigs.length)return event.NextToken=result.NextToken,new Promise(function(res,rej){!function next(index){var item=result.EndpointConfigs[index];item?sagemaker.deleteEndpointConfig({EndpointConfigName:item.EndpointConfigName}).promise().then(x=>next(index-1)).catch(error=>{"ThrottlingException"===error.code?setTimeout(()=>next(index),2e3):rej(error)}):res()}(0)}).then(()=>lambda.invoke({FunctionName:process.env.AWS_LAMBDA_FUNCTION_NAME,InvocationType:"Event",Payload:JSON.stringify(event)}).promise());response.send(event,context,response.SUCCESS)}).catch(error=>{console.log(error),response.send(event,context,response.FAILED)}):response.send(event,context,response.SUCCESS)};